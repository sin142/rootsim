<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚«ãƒ–ä¾¡ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚²ãƒ¼ãƒ </title>
    <!-- Tailwind CSSã¨Chart.jsã‚’CDNã‹ã‚‰èª­ã¿è¾¼ã¿ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ãƒ•ã‚©ãƒ³ãƒˆã®èª­ã¿è¾¼ã¿ */
        @import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;500;700&family=Yusei+Magic&display=swap');

        /* å…¨ä½“çš„ãªä¸–ç•Œè¦³ãƒ»é›°å›²æ°—ã®è¨­å®š */
        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            background-color: #a7d984; /* æ˜ã‚‹ã„è‰åœ°ã®èƒŒæ™¯è‰² */
            background-image: url('https://www.transparenttextures.com/patterns/light-grass.png');
            color: #5c4033; /* æ¿ƒã„èŒ¶è‰²ã®ãƒ†ã‚­ã‚¹ãƒˆ */
        }
        
        /* ã‚¿ã‚¤ãƒˆãƒ«ç”¨ã®æ‰‹æ›¸ãé¢¨ãƒ•ã‚©ãƒ³ãƒˆ */
        .font-title {
            font-family: 'Yusei Magic', sans-serif;
        }

        /* æœ¨ã®æ¿é¢¨ãƒ‘ãƒãƒ« */
        .panel-wood {
            background-color: #d2b48c; /* æœ¨ã®è‰² */
            background-image: url('https://www.transparenttextures.com/patterns/wood-pattern.png');
            border: 6px solid #8b5a2b; /* æ¿ƒã„æœ¨ã®æ  */
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2), inset 0 0 10px rgba(255,255,255,0.3);
            position: relative;
        }
        
        /* ç´™ã®èƒŒæ™¯ï¼ˆãƒ‘ãƒãƒ«ã®å†…å´ï¼‰ */
        .panel-paper {
            background-color: #f5f5dc; /* ãƒ™ãƒ¼ã‚¸ãƒ¥ï¼ˆç´™ã®è‰²ï¼‰ */
            background-image: url('https://www.transparenttextures.com/patterns/paper-fibers.png');
            border-radius: 12px;
            padding: 16px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        /* ã·ã£ãã‚Šã—ãŸãƒœã‚¿ãƒ³ */
        .game-btn {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            font-weight: 700;
            color: #5c4033;
            background-color: #fde68a; /* é»„è‰²ã„ãƒ‘ã‚¹ãƒ†ãƒ«ã‚«ãƒ©ãƒ¼ */
            border: 2px solid #ca8a04;
            border-radius: 9999px; /* å††å½¢ã« */
            padding: 10px 16px;
            box-shadow: 0 4px #d97706;
            transition: all 0.1s ease-in-out;
        }
        .game-btn:hover {
            background-color: #fef08a;
        }
        .game-btn:active {
            transform: translateY(3px);
            box-shadow: 0 1px #d97706;
        }
        .game-btn:disabled {
            background-color: #d1d5db;
            box-shadow: 0 4px #9ca3af;
            color: #6b7280;
            cursor: not-allowed;
            transform: translateY(0);
        }

        /* ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã®ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ« */
        .custom-select {
            appearance: none;
            background-color: #ffffff;
            border: 2px solid #8b5a2b;
            border-radius: 8px;
            padding: 8px 12px;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%238b5a2b' stroke-linecap='round' stroke-linejoin='round' stroke-width='2.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            color: #5c4033;
        }
        
        /* ç¸«ã„ç›®ï¼ˆã‚¹ãƒ†ãƒƒãƒï¼‰é¢¨ã®æƒ…å ±ãƒ‘ãƒãƒ« */
        .stitched-box {
             background-color: #e0f2fe; /* æ·¡ã„æ°´è‰²ã®å¸ƒåœ° */
             border-radius: 10px;
             border: 2px dashed #38bdf8; /* æ°´è‰²ã®ç‚¹ç·š */
             padding: 12px;
             text-align: center;
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8">

    <header class="text-center mb-8">
        <h1 class="font-title text-4xl sm:text-5xl font-bold text-brown" style="text-shadow: 2px 2px 4px #8b5a2b;">ğŸ’° ã‚«ãƒ–ä¾¡ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚²ãƒ¼ãƒ </h1>
        <p class="text-white font-medium mt-2" style="text-shadow: 1px 1px 2px #8b5a2b;">ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãˆã‚‰ã‚“ã§ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã¯ã˜ã‚ã¦ã­ï¼</p>
    </header>

    <main class="grid grid-cols-1 lg:grid-cols-2 gap-8 max-w-7xl mx-auto">

        <!-- â–¼â–¼â–¼ ã€Œã‚ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ã‚²ãƒ¼ãƒ ãƒ‘ãƒãƒ« â–¼â–¼â–¼ -->
        <div class="panel-wood">
            <div class="panel-paper">
                <h2 class="font-title text-2xl font-bold text-cyan-800 mb-4 text-center">ãƒãƒ¼ã‚¸ãƒ§ãƒ³ ã€Œã‚ã€</h2>
                
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label for="pattern-select-a" class="block text-sm font-medium mb-1">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³</label>
                        <select id="pattern-select-a" class="custom-select w-full"></select>
                    </div>
                    <div class="flex items-end space-x-3">
                        <button id="start-btn-a" class="game-btn w-full">é–‹å§‹</button>
                        <button id="next-day-btn-a" class="game-btn w-full" disabled>æ¬¡ã®æ—¥ã¸</button>
                    </div>
                </div>

                <div class="grid grid-cols-2 sm:grid-cols-3 gap-4 mb-6">
                    <div class="stitched-box">
                        <p class="text-xs">ãƒ‘ã‚¿ãƒ¼ãƒ³</p>
                        <p id="pattern-display-a" class="text-lg font-bold">-</p>
                    </div>
                    <div class="stitched-box">
                        <p class="text-xs">ã‚ˆã†ã³</p>
                        <p id="day-of-week-display-a" class="text-lg font-bold">-</p>
                    </div>
                    <div class="stitched-box col-span-2 sm:col-span-1">
                        <p class="text-xs">ã„ã¾ã®ã‚«ãƒ–ä¾¡</p>
                        <p id="price-display-a" class="text-lg font-bold">-</p>
                    </div>
                </div>

                <div class="mb-6 overflow-x-auto bg-white/50 rounded-lg p-2">
                    <table class="w-full text-sm text-center">
                        <thead class="text-xs">
                            <tr>
                                <th class="p-2 font-medium">è²·å€¤</th>
                                <th class="p-2 font-medium">æœˆ</th>
                                <th class="p-2 font-medium">ç«</th>
                                <th class="p-2 font-medium">æ°´</th>
                                <th class="p-2 font-medium">æœ¨</th>
                                <th class="p-2 font-medium">é‡‘</th>
                                <th class="p-2 font-medium">åœŸ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr id="weekly-table-a">
                                <td class="p-2 font-bold">-</td><td class="p-2 font-bold">-</td><td class="p-2 font-bold">-</td><td class="p-2 font-bold">-</td><td class="p-2 font-bold">-</td><td class="p-2 font-bold">-</td><td class="p-2 font-bold">-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div><canvas id="stock-chart-a"></canvas></div>
            </div>
        </div>

        <!-- â–¼â–¼â–¼ ã€Œã‚“ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ã‚²ãƒ¼ãƒ ãƒ‘ãƒãƒ« â–¼â–¼â–¼ -->
        <div class="panel-wood">
            <div class="panel-paper">
                 <h2 class="font-title text-2xl font-bold text-rose-800 mb-4 text-center">ãƒãƒ¼ã‚¸ãƒ§ãƒ³ ã€Œã‚“ã€</h2>
            
                 <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label for="pattern-select-n" class="block text-sm font-medium mb-1">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³</label>
                        <select id="pattern-select-n" class="custom-select w-full"></select>
                    </div>
                    <div class="flex items-end space-x-3">
                        <button id="start-btn-n" class="game-btn w-full">é–‹å§‹</button>
                        <button id="next-day-btn-n" class="game-btn w-full" disabled>æ¬¡ã®æ—¥ã¸</button>
                    </div>
                </div>

                <div class="grid grid-cols-2 sm:grid-cols-3 gap-4 mb-6">
                    <div class="stitched-box !border-rose-300 !bg-rose-50">
                        <p class="text-xs">ãƒ‘ã‚¿ãƒ¼ãƒ³</p>
                        <p id="pattern-display-n" class="text-lg font-bold">-</p>
                    </div>
                     <div class="stitched-box !border-rose-300 !bg-rose-50">
                        <p class="text-xs">ã‚ˆã†ã³</p>
                        <p id="day-of-week-display-n" class="text-lg font-bold">-</p>
                    </div>
                    <div class="stitched-box !border-rose-300 !bg-rose-50 col-span-2 sm:col-span-1">
                        <p class="text-xs">ã„ã¾ã®ã‚«ãƒ–ä¾¡</p>
                        <p id="price-display-n" class="text-lg font-bold">-</p>
                    </div>
                </div>

                <div class="mb-6 overflow-x-auto bg-white/50 rounded-lg p-2">
                     <table class="w-full text-sm text-center">
                        <thead class="text-xs">
                            <tr>
                                <th class="p-2 font-medium">è²·å€¤</th><th class="p-2 font-medium">æœˆ</th><th class="p-2 font-medium">ç«</th><th class="p-2 font-medium">æ°´</th><th class="p-2 font-medium">æœ¨</th><th class="p-2 font-medium">é‡‘</th><th class="p-2 font-medium">åœŸ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr id="weekly-table-n">
                                <td class="p-2 font-bold">-</td><td class="p-2 font-bold">-</td><td class="p-2 font-bold">-</td><td class="p-2 font-bold">-</td><td class="p-2 font-bold">-</td><td class="p-2 font-bold">-</td><td class="p-2 font-bold">-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div><canvas id="stock-chart-n"></canvas></div>
            </div>
        </div>
    </main>

    <script>
        // ===============================================================
        // ãƒ‡ãƒ¼ã‚¿å®šç¾© (æ©Ÿèƒ½ã¯å¤‰æ›´ãªã—)
        // ===============================================================
        const patternsA = [
            { name: "ã¯", initialPrice: 100, rates: [1.5, 0.51, 1.42, 1.36, 0.64, 0.28], randomRange: 10 },
            { name: "ãª", initialPrice: 100, rates: [1.2, 0.98, 1.5, 0.95, 2.2, 1.94], randomRange: 10 },
            { name: "ãˆ", initialPrice: 100, rates: [1.2, 0.85, 1.15, 0.9, 1.05, 0.95], randomRange: 10 }
        ];
        const patternsN = [
            { name: "ã¯", initialPrice: 100, rates: [0.9, 0.8, 0.7, 1.7, 1.1, 3.0], randomRange: 10 },
            { name: "ãª", initialPrice: 100, rates: [1.0, 0.95, 0.90, 0.85, 0.80, 0.75], randomRange: 10 },
            { name: "ãˆ", initialPrice: 100, rates: [3.0, 1.43, 1.11, 0.7, 0.6, 1.5], randomRange: 10 }
        ];
        const daysOfWeek = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
        const gameState = {
            a: { isActive: false, currentDayIndex: 0, chartInstance: null },
            n: { isActive: false, currentDayIndex: 0, chartInstance: null }
        };
        const domElements = {
            a: {
                select: document.getElementById('pattern-select-a'),
                startBtn: document.getElementById('start-btn-a'),
                nextDayBtn: document.getElementById('next-day-btn-a'),
                patternDisplay: document.getElementById('pattern-display-a'),
                dayOfWeekDisplay: document.getElementById('day-of-week-display-a'),
                priceDisplay: document.getElementById('price-display-a'),
                weeklyTable: document.getElementById('weekly-table-a').cells,
                chartCanvas: document.getElementById('stock-chart-a'),
                patterns: patternsA
            },
            n: {
                select: document.getElementById('pattern-select-n'),
                startBtn: document.getElementById('start-btn-n'),
                nextDayBtn: document.getElementById('next-day-btn-n'),
                patternDisplay: document.getElementById('pattern-display-n'),
                dayOfWeekDisplay: document.getElementById('day-of-week-display-n'),
                priceDisplay: document.getElementById('price-display-n'),
                weeklyTable: document.getElementById('weekly-table-n').cells,
                chartCanvas: document.getElementById('stock-chart-n'),
                patterns: patternsN
            }
        };

        // ===============================================================
        // åˆæœŸåŒ–å‡¦ç† (æ©Ÿèƒ½ã¯å¤‰æ›´ãªã—)
        // ===============================================================
        document.addEventListener('DOMContentLoaded', () => {
            populateDropdown('a');
            populateDropdown('n');
            domElements.a.startBtn.addEventListener('click', () => initializeSimulation('a'));
            domElements.a.nextDayBtn.addEventListener('click', () => nextDay('a'));
            domElements.n.startBtn.addEventListener('click', () => initializeSimulation('n'));
            domElements.n.nextDayBtn.addEventListener('click', () => nextDay('n'));
        });

        function populateDropdown(version) {
            const { select, patterns } = domElements[version];
            patterns.forEach((pattern, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = pattern.name;
                select.appendChild(option);
            });
        }

        // ===============================================================
        // ã‚²ãƒ¼ãƒ é€²è¡Œé–¢æ•° (æ©Ÿèƒ½ã¯å¤‰æ›´ãªã—ã€è¡¨ç¤ºã®å˜ä½ã‚’ã€Œãƒ™ãƒ«ã€ã«å¤‰æ›´)
        // ===============================================================
        function initializeSimulation(version) {
            const state = gameState[version];
            const dom = domElements[version];

            state.isActive = true;
            state.currentDayIndex = 1;

            const patternIndex = dom.select.value;
            const pattern = dom.patterns[patternIndex];
            const sundayPrice = pattern.initialPrice;
            const mondayPrice = Math.round(calculateNewPrice(sundayPrice, pattern, 1));

            dom.patternDisplay.textContent = pattern.name;
            dom.dayOfWeekDisplay.textContent = daysOfWeek[1];
            dom.priceDisplay.textContent = `${mondayPrice.toLocaleString()}ãƒ™ãƒ«`;
            
            Array.from(dom.weeklyTable).forEach(td => td.textContent = '-');
            dom.weeklyTable[0].textContent = `${sundayPrice.toLocaleString()}ãƒ™ãƒ«`;
            dom.weeklyTable[1].textContent = `${mondayPrice.toLocaleString()}ãƒ™ãƒ«`;
            dom.nextDayBtn.disabled = false;
            
            if (state.chartInstance) {
                state.chartInstance.destroy();
            }
            createChart(version, pattern.name, [sundayPrice, mondayPrice]);
        }

        function nextDay(version) {
            const state = gameState[version];
            const dom = domElements[version];
            
            if (!state.isActive) return;
            const currentDay = state.currentDayIndex;
            
            if (currentDay >= 6) {
                state.isActive = false;
                dom.nextDayBtn.disabled = true;
                alert('ä»Šé€±ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯ãŠã‚ã‚Šã ã‚ˆï¼');
                return;
            }

            const nextDayIndex = currentDay + 1;
            const patternIndex = dom.select.value;
            const pattern = dom.patterns[patternIndex];
            const initialPrice = pattern.initialPrice;
            const newPrice = Math.round(calculateNewPrice(initialPrice, pattern, nextDayIndex));

            dom.dayOfWeekDisplay.textContent = daysOfWeek[nextDayIndex];
            dom.priceDisplay.textContent = `${newPrice.toLocaleString()}ãƒ™ãƒ«`;
            dom.weeklyTable[nextDayIndex].textContent = `${newPrice.toLocaleString()}ãƒ™ãƒ«`;

            updateChart(version, newPrice, nextDayIndex);

            state.currentDayIndex = nextDayIndex;
        }

        // ===============================================================
        // è£œåŠ©é–¢æ•° (æ©Ÿèƒ½ã¯å¤‰æ›´ãªã—)
        // ===============================================================
        function calculateNewPrice(basePrice, pattern, dayIndex) {
            const rate = pattern.rates[dayIndex - 1];
            const randomPercent = pattern.randomRange / 100;
            const randomFactor = 1 + (Math.random() - 0.5) * 2 * randomPercent;
            const newPrice = basePrice * rate * randomFactor;
            return Math.max(1, newPrice);
        }

        // ã‚°ãƒ©ãƒ•æç”»é–¢æ•°ï¼ˆãƒ‡ã‚¶ã‚¤ãƒ³ã‚’ãƒ†ãƒ¼ãƒã«åˆã‚ã›ã‚‹ï¼‰
        function createChart(version, patternName, initialData) {
            const state = gameState[version];
            const { chartCanvas } = domElements[version];
            const ctx = chartCanvas.getContext('2d');
            
            const labels = ['è²·å€¤', daysOfWeek[1]];
            
            // Chart.jsã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ•ã‚©ãƒ³ãƒˆã‚’è¨­å®š
            Chart.defaults.font.family = "'M PLUS Rounded 1c', sans-serif";
            Chart.defaults.font.size = 12;
            Chart.defaults.color = '#5c4033';
            
            state.chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `ã‚«ãƒ–ä¾¡ã®ã†ã”ã`,
                        data: initialData,
                        borderColor: version === 'a' ? '#0891b2' : '#be123c',
                        backgroundColor: version === 'a' ? 'rgba(6, 182, 212, 0.2)' : 'rgba(244, 63, 94, 0.2)',
                        fill: true,
                        tension: 0.3,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: version === 'a' ? '#0891b2' : '#be123c',
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: { 
                            beginAtZero: false, 
                            ticks: { color: '#8b5a2b' }, 
                            grid: { color: 'rgba(139, 90, 43, 0.2)', borderDash: [2, 3] }
                        },
                        x: { 
                            ticks: { color: '#8b5a2b' }, 
                            grid: { display: false }
                        }
                    },
                    plugins: { 
                        legend: { 
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: {
                                    weight: 'bold'
                                }
                             }
                        } 
                    }
                }
            });
        }

        function updateChart(version, newPrice, dayIndex) {
            const state = gameState[version];
            const chart = state.chartInstance;

            if (chart) {
                chart.data.labels.push(daysOfWeek[dayIndex]);
                chart.data.datasets[0].data.push(newPrice);
                chart.update();
            }
        }
    </script>
</body>
</html>
